---
id: "009"
name: Implement wizard mode with Huh forms
status: completed
created: 2025-12-23T19:45:00Z
updated: 2025-12-23T20:15:00Z
depends_on: ["006"]
parallel: true
conflicts_with: []
effort: L
---

# Task: Implement Wizard Mode with Huh Forms

## Description

Implement the 4-step wizard mode (Wireframes #4, #5, #14, #15, #16) using Huh forms for approval gates. The wizard guides users through PRD → Epic → Tasks → Sync with approval at each step.

## Acceptance Criteria

- [ ] Step indicator shows current phase (1/4, 2/4, 3/4, 4/4)
- [ ] Progress stepper: [■]────[◐]────[○]────[○]
- [ ] Step 1: PRD Review with approval confirm
- [ ] Step 2: Epic Review with approval confirm
- [ ] Step 3: Tasks Review with task list preview
- [ ] Step 4: GitHub Sync choice (yes/no/skip)
- [ ] Revision mode collects feedback text
- [ ] ESC cancels wizard and returns to dashboard
- [ ] Approval adds ✅ APPROVED to documents

## Files to Create

### internal/tui/views/wizard.go

```go
package views

import (
    "github.com/charmbracelet/huh"
    "github.com/charmbracelet/bubbles/viewport"
    "github.com/charmbracelet/lipgloss"
)

// WizardStep tracks current wizard phase
type WizardStep int

const (
    WizardStepPRD WizardStep = iota
    WizardStepEpic
    WizardStepTasks
    WizardStepSync
)

type WizardModel struct {
    Step        WizardStep
    EpicName    string
    PRDContent  string
    EpicContent string
    Tasks       []Task
    Approved    bool
    Feedback    string
    Revising    bool
    SyncChoice  string
    Viewport    viewport.Model
    Form        *huh.Form
}

func (m Model) viewWizard() string {
    // Step indicator
    stepper := m.renderWizardStepper()
    
    // Content based on step
    var content string
    switch m.WizardStep {
    case 0: // PRD Review
        content = m.viewWizardPRD()
    case 1: // Epic Review
        content = m.viewWizardEpic()
    case 2: // Tasks Review
        content = m.viewWizardTasks()
    case 3: // Sync Choice
        content = m.viewWizardSync()
    }
    
    // Footer
    footer := MutedStyle.Render("[↑/↓]navigate  [⏎]select  [esc]cancel wizard")
    
    return lipgloss.JoinVertical(
        lipgloss.Left,
        "",
        m.renderWizardHeader(),
        stepper,
        "",
        content,
        "",
        footer,
    )
}

func (m Model) renderWizardHeader() string {
    step := fmt.Sprintf("Step %d/4", m.WizardStep + 1)
    
    header := ElevatedCard.Render(lipgloss.JoinVertical(
        lipgloss.Left,
        TitleStyle.Render("EPIC WIZARD"),
        strings.Repeat("═", 60),
        "",
        step,
    ))
    
    return header
}

func (m Model) renderWizardStepper() string {
    steps := []string{"PRD", "Epic", "Tasks", "Sync"}
    states := []string{"○", "○", "○", "○"}
    labels := []string{"Pending", "Pending", "Pending", "Pending"}
    
    for i := 0; i < int(m.WizardStep); i++ {
        states[i] = "■"
        labels[i] = "✓ Done"
    }
    states[m.WizardStep] = "◐"
    labels[m.WizardStep] = "Review"
    
    stepper := fmt.Sprintf(
        "    [%s]────────[%s]────────[%s]────────[%s]",
        states[0], states[1], states[2], states[3],
    )
    labelLine := fmt.Sprintf(
        "    %s        %s       %s      %s",
        steps[0], steps[1], steps[2], steps[3],
    )
    statusLine := fmt.Sprintf(
        "    %s      %s     %s    %s",
        labels[0], labels[1], labels[2], labels[3],
    )
    
    return lipgloss.JoinVertical(lipgloss.Left, stepper, labelLine, statusLine)
}

func (m Model) viewWizardPRD() string {
    // Document preview
    title := LabelStyle.Render("REVIEW: PRD DOCUMENT")
    m.Viewport.SetContent(m.PRDContent)
    doc := SubtleCard.Render(
        lipgloss.JoinVertical(lipgloss.Left, title, m.Viewport.View()),
    )
    
    // Approval prompt using Huh
    if m.Revising {
        return lipgloss.JoinVertical(lipgloss.Left, doc, m.viewRevisionInput())
    }
    
    approval := AlertCard.Render(`
? Do you approve this PRD?

  › ✓ Yes, proceed to Epic generation
    ✗ No, I need to make changes
`)
    
    return lipgloss.JoinVertical(lipgloss.Left, doc, "", approval)
}

func (m Model) viewRevisionInput() string {
    return AlertCard.Render(`
What changes are needed?

┌───────────────────────────────────────────────────────┐
│                                                       │
│  ` + m.Feedback + `█                                  │
│                                                       │
└───────────────────────────────────────────────────────┘

Characters: ` + fmt.Sprintf("%d/500", len(m.Feedback)) + `

Tip: Be specific about what needs to change.
`)
}

func (m Model) viewWizardSync() string {
    // Summary
    summary := ElevatedCard.Render(fmt.Sprintf(`
◆ %s

PRD:    .claude/prds/%s.md          ✅ APPROVED
Epic:   .claude/epics/%s/epic.md    ✅ APPROVED
Tasks:  %d tasks ready for execution  ✅ APPROVED

Ready to begin work! You can now start executing tasks.
`, m.WizardName, m.WizardName, m.WizardName, len(m.Tasks)))
    
    // Sync choice
    choice := AlertCard.Render(`
? Sync epic to GitHub?

  › ⟳ Yes, create GitHub issues now
    ○ No, work locally only
    ⏭ Skip for now, I'll sync later
`)
    
    tip := MutedStyle.Render(`
Tip: Working locally is great for offline development.
     Sync to GitHub anytime with [s] from the dashboard.
`)
    
    return lipgloss.JoinVertical(lipgloss.Left, summary, "", choice, "", tip)
}
```

## Huh Form Integration

```go
func createApprovalForm() *huh.Form {
    var approved bool
    
    return huh.NewForm(
        huh.NewGroup(
            huh.NewConfirm().
                Title("Do you approve?").
                Affirmative("Yes, proceed").
                Negative("No, revise").
                Value(&approved),
        ),
    )
}

func createRevisionForm() *huh.Form {
    var feedback string
    
    return huh.NewForm(
        huh.NewGroup(
            huh.NewText().
                Title("What changes are needed?").
                CharLimit(500).
                Value(&feedback),
        ),
    )
}
```

## Design Reference

- Wizard Step 1 (PRD): TUI-WIREFRAMES.md lines 909-956 (Wireframe #14)
- Wizard Step 2 (Epic): TUI-WIREFRAMES.md lines 467-516 (Wireframe #4)
- Wizard Revision: TUI-WIREFRAMES.md lines 518-561 (Wireframe #5)
- Wizard Step 3 (Tasks): TUI-WIREFRAMES.md lines 958-1012 (Wireframe #15)
- Wizard Step 4 (Sync): TUI-WIREFRAMES.md lines 1014-1065 (Wireframe #16)

## Definition of Done

- All 4 wizard steps render correctly
- Step indicator shows correct progress
- Huh forms capture approval/rejection
- Revision feedback loop works
- Documents marked with ✅ APPROVED on approval
- ESC cancels and returns to dashboard
