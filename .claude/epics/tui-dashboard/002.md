---
id: "002"
name: Implement approval markers & phase recovery
status: completed
created: 2025-12-23T19:45:00Z
updated: 2025-12-23T20:05:00Z
depends_on: []
parallel: true
conflicts_with: []
effort: S
---

# Task: Implement Approval Markers & Phase Recovery

## Description

Add `status: approved` markers to document frontmatter when users approve phases in the wizard. Implement phase recovery logic so that re-running `/pm:epic-wizard` resumes from the last incomplete phase rather than starting over.

## Acceptance Criteria

- [ ] PRD frontmatter includes `status` field (pending | approved | revision-needed)
- [ ] Epic frontmatter includes `status` field
- [ ] Approved documents include `approved_at` timestamp
- [ ] Revision count tracked in `revision_count` field
- [ ] Phase recovery detects existing approved documents
- [ ] Wizard skips already-approved phases on re-run
- [ ] Clear message when resuming: "Resuming from Phase {N}..."

## Frontmatter Schema

### PRD Frontmatter
```yaml
---
name: user-authentication
status: approved          # pending | approved | revision-needed
created: 2025-12-23T09:00:00Z
approved_at: 2025-12-23T09:15:00Z
revision_count: 0
---
```

### Epic Frontmatter
```yaml
---
name: user-authentication
status: approved          # pending | approved | revision-needed
created: 2025-12-23T09:15:00Z
approved_at: 2025-12-23T09:30:00Z
revision_count: 0
prd: user-authentication
---
```

### Task Frontmatter
```yaml
---
id: "001"
name: Set up auth middleware
status: pending           # pending | in-progress | completed | blocked
created: 2025-12-23T09:30:00Z
epic: user-authentication
---
```

## Phase Recovery Logic

```
When /pm:epic-wizard {name} runs:

1. Check .claude/prds/{name}.md
   ├── Not exists → Start at Phase 1
   ├── Exists, status: pending → Start at Phase 1 (review)
   └── Exists, status: approved → Skip to Phase 2

2. Check .claude/epics/{name}/epic.md
   ├── Not exists → Start at Phase 2
   ├── Exists, status: pending → Start at Phase 2 (review)
   └── Exists, status: approved → Skip to Phase 3

3. Check .claude/epics/{name}/001.md (any task file)
   ├── Not exists → Start at Phase 3
   └── Exists → Skip to Phase 4

4. Check epic status: approved-for-work
   ├── Not set → Start at Phase 3 (review tasks)
   └── Set → Skip to Phase 4 (sync choice)
```

## Files to Modify

- `ccpm/skills/ccpm-prd/workflows/` - Add status field handling
- `ccpm/skills/ccpm-epic/workflows/` - Add status field handling
- `ccpm/skills/shared-references/frontmatter-operations.md` - Document new fields

## Definition of Done

- All frontmatter schemas updated with status fields
- Phase recovery logic implemented in epic-wizard
- Re-running wizard correctly resumes from last phase
- Status transitions work correctly (pending → approved)
