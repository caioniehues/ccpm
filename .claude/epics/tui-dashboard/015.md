---
id: "015"
name: Add animations and loading states
status: completed
created: 2025-12-23T19:45:00Z
updated: 2025-12-23T22:41:00Z
depends_on: ["007", "008", "009", "010"]
parallel: true
conflicts_with: []
effort: M
---

# Task: Add Animations and Loading States

## Description

Implement the animation specifications from the design: spinners, progress bar animations, success flashes, error shakes, and notification toasts.

## Acceptance Criteria

- [x] Loading spinner with braille animation (⠋⠙⠹⠸⠼⠴⠦⠧⠇⠏)
- [x] Progress bar gradient animation on updates
- [x] Cursor blink animation (530ms)
- [x] In-progress task pulse animation
- [x] Sync indicator rotation
- [x] Success flash on completion (green highlight, 300ms)
- [x] Error shake on failures (horizontal jitter)
- [x] Notification toasts (success, error, warning, info)
- [x] Toast auto-dismiss (3s for success/info, 5s for warning)
- [x] Toast stacking for multiple notifications

## Files to Create/Update

### internal/tui/components/spinner.go

```go
package components

import (
    "time"
    "github.com/charmbracelet/bubbles/spinner"
    tea "github.com/charmbracelet/bubbletea"
)

// BrailleSpinner creates the loading spinner
func BrailleSpinner() spinner.Model {
    s := spinner.New()
    s.Spinner = spinner.Spinner{
        Frames: []string{"⠋", "⠙", "⠹", "⠸", "⠼", "⠴", "⠦", "⠧", "⠇", "⠏"},
        FPS:    time.Second / 12, // 80ms per frame
    }
    s.Style = AccentStyle
    return s
}

// SyncSpinner for syncing indicator
func SyncSpinner() spinner.Model {
    s := spinner.New()
    s.Spinner = spinner.Spinner{
        Frames: []string{"⟳", "↻", "⟳", "↺"},
        FPS:    time.Second / 6, // 150ms per frame
    }
    s.Style = AccentStyle
    return s
}
```

### internal/tui/components/toast.go

```go
package components

import (
    "time"
    tea "github.com/charmbracelet/bubbletea"
    "github.com/charmbracelet/lipgloss"
)

type ToastType int

const (
    ToastSuccess ToastType = iota
    ToastError
    ToastWarning
    ToastInfo
)

type Toast struct {
    Message   string
    Type      ToastType
    CreatedAt time.Time
    Duration  time.Duration
}

type ToastModel struct {
    Toasts    []Toast
    MaxToasts int
}

type ToastDismissMsg struct {
    Index int
}

func NewToastModel() ToastModel {
    return ToastModel{
        MaxToasts: 5,
    }
}

func (t *ToastModel) Add(msg string, toastType ToastType) tea.Cmd {
    duration := 3 * time.Second
    switch toastType {
    case ToastError:
        duration = 0 // Requires manual dismiss
    case ToastWarning:
        duration = 5 * time.Second
    }
    
    toast := Toast{
        Message:   msg,
        Type:      toastType,
        CreatedAt: time.Now(),
        Duration:  duration,
    }
    
    t.Toasts = append(t.Toasts, toast)
    if len(t.Toasts) > t.MaxToasts {
        t.Toasts = t.Toasts[1:]
    }
    
    if duration > 0 {
        return tea.Tick(duration, func(time.Time) tea.Msg {
            return ToastDismissMsg{Index: len(t.Toasts) - 1}
        })
    }
    return nil
}

func (t *ToastModel) Dismiss(index int) {
    if index >= 0 && index < len(t.Toasts) {
        t.Toasts = append(t.Toasts[:index], t.Toasts[index+1:]...)
    }
}

func (t ToastModel) View() string {
    if len(t.Toasts) == 0 {
        return ""
    }
    
    var toastViews []string
    for _, toast := range t.Toasts {
        toastViews = append(toastViews, t.renderToast(toast))
    }
    
    return lipgloss.JoinVertical(lipgloss.Right, toastViews...)
}

func (t ToastModel) renderToast(toast Toast) string {
    icon := "ℹ"
    style := InfoStyle
    
    switch toast.Type {
    case ToastSuccess:
        icon = "✓"
        style = SuccessStyle
    case ToastError:
        icon = "⊗"
        style = ErrorStyle
    case ToastWarning:
        icon = "⚠"
        style = WarningStyle
    }
    
    content := fmt.Sprintf("%s %s  ✗", icon, toast.Message)
    
    return style.
        Border(lipgloss.RoundedBorder()).
        Padding(0, 1).
        Render(content)
}
```

### internal/tui/components/animations.go

```go
package components

import (
    "time"
    tea "github.com/charmbracelet/bubbletea"
)

// SuccessFlashMsg triggers a success flash
type SuccessFlashMsg struct {
    Target string
}

// SuccessFlashDoneMsg ends the flash
type SuccessFlashDoneMsg struct {
    Target string
}

// ErrorShakeMsg triggers error shake
type ErrorShakeMsg struct {
    Target string
}

// ErrorShakeDoneMsg ends the shake
type ErrorShakeDoneMsg struct {
    Target string
}

// SuccessFlash returns a command that triggers flash animation
func SuccessFlash(target string) tea.Cmd {
    return func() tea.Msg {
        return SuccessFlashMsg{Target: target}
    }
}

// SuccessFlashEnd returns after 300ms
func SuccessFlashEnd(target string) tea.Cmd {
    return tea.Tick(300*time.Millisecond, func(time.Time) tea.Msg {
        return SuccessFlashDoneMsg{Target: target}
    })
}

// ErrorShake returns a command that triggers shake animation
func ErrorShake(target string) tea.Cmd {
    return func() tea.Msg {
        return ErrorShakeMsg{Target: target}
    }
}

// ErrorShakeEnd returns after 200ms (3 shake cycles)
func ErrorShakeEnd(target string) tea.Cmd {
    return tea.Tick(200*time.Millisecond, func(time.Time) tea.Msg {
        return ErrorShakeDoneMsg{Target: target}
    })
}

// PulseAnimation for in-progress items
type PulseMsg struct{}

func Pulse() tea.Cmd {
    return tea.Tick(1000*time.Millisecond, func(time.Time) tea.Msg {
        return PulseMsg{}
    })
}
```

### Update views to use animations

```go
// In viewDashboard, handle flash state
func (m Model) renderTaskItem(task Task, selected bool) string {
    style := BodyStyle
    
    // Apply flash if active
    if m.FlashTarget == task.ID {
        style = style.Background(Volt).Foreground(Void)
    }
    
    // Apply shake if active
    offset := ""
    if m.ShakeTarget == task.ID {
        offset = "  " // Shift right
    }
    
    return offset + style.Render(task.Name)
}
```

## Design Reference

- Animation Specs: TUI-WIREFRAMES.md lines 1264-1315
- Loading State: TUI-WIREFRAMES.md lines 648-680 (Wireframe #8)
- Notification Toasts: TUI-WIREFRAMES.md lines 861-907 (Wireframe #13)

## Definition of Done

- All animation types implemented
- Spinners animate smoothly
- Success flash triggers on task completion
- Error shake triggers on failures
- Toasts appear and auto-dismiss correctly
- Multiple toasts stack properly
