---
id: "017"
name: Testing and documentation
status: pending
created: 2025-12-23T19:45:00Z
updated: 2025-12-23T19:45:00Z
depends_on: ["015", "016"]
parallel: false
conflicts_with: []
effort: M
---

# Task: Testing and Documentation

## Description

Write comprehensive tests for the TUI components and parsers. Update documentation to cover the new dashboard functionality.

## Acceptance Criteria

### Testing
- [ ] Unit tests for all parsers (epic, task, PRD)
- [ ] Unit tests for layout calculations
- [ ] Unit tests for frontmatter parsing
- [ ] Integration test for file watcher
- [ ] Manual test script for visual verification
- [ ] Test coverage > 70% for parser package

### Documentation
- [ ] Update README.md with dashboard section
- [ ] Update COMMANDS.md with new commands
- [ ] Create dashboard usage guide
- [ ] Add keyboard shortcuts reference
- [ ] Document build instructions

## Files to Create

### internal/tui/parser/epic_test.go

```go
package parser

import (
    "os"
    "path/filepath"
    "testing"
)

func TestParseEpic(t *testing.T) {
    // Create temp directory with test epic
    tmpDir := t.TempDir()
    epicDir := filepath.Join(tmpDir, "test-epic")
    os.MkdirAll(epicDir, 0755)
    
    // Write test epic.md
    epicContent := `---
name: test-epic
status: approved
created: 2025-12-23T10:00:00Z
prd: test-prd
---

# Test Epic

This is a test epic for unit testing.
`
    os.WriteFile(filepath.Join(epicDir, "epic.md"), []byte(epicContent), 0644)
    
    // Write test task
    taskContent := `---
id: "001"
name: Test Task
status: completed
---

## Task Description

Test task content.

- [x] Acceptance criteria 1
- [ ] Acceptance criteria 2
`
    os.WriteFile(filepath.Join(epicDir, "001.md"), []byte(taskContent), 0644)
    
    // Parse and verify
    epic, err := ParseEpic(epicDir)
    if err != nil {
        t.Fatalf("ParseEpic failed: %v", err)
    }
    
    if epic.Name != "test-epic" {
        t.Errorf("Expected name 'test-epic', got '%s'", epic.Name)
    }
    
    if epic.Status != "approved" {
        t.Errorf("Expected status 'approved', got '%s'", epic.Status)
    }
    
    if epic.TaskCount != 1 {
        t.Errorf("Expected 1 task, got %d", epic.TaskCount)
    }
    
    if epic.DoneCount != 1 {
        t.Errorf("Expected 1 done, got %d", epic.DoneCount)
    }
}

func TestCalculateCheckboxProgress(t *testing.T) {
    tests := []struct {
        content  string
        expected float64
    }{
        {"- [x] Done\n- [ ] Not done", 0.5},
        {"- [x] Done\n- [x] Also done", 1.0},
        {"- [ ] Not done\n- [ ] Also not done", 0.0},
        {"No checkboxes here", 0.0},
        {"- [X] Case insensitive", 1.0},
    }
    
    for _, tt := range tests {
        result := calculateCheckboxProgress(tt.content)
        if result != tt.expected {
            t.Errorf("For content '%s': expected %f, got %f", 
                tt.content, tt.expected, result)
        }
    }
}

func TestSplitFrontmatter(t *testing.T) {
    content := `---
name: test
status: pending
---

# Body content

More content here.`
    
    fm, body := splitFrontmatter(content)
    
    if !strings.Contains(fm, "name: test") {
        t.Errorf("Frontmatter should contain 'name: test'")
    }
    
    if !strings.Contains(body, "# Body content") {
        t.Errorf("Body should contain '# Body content'")
    }
}
```

### internal/tui/layout_test.go

```go
package tui

import "testing"

func TestCalculateLayout(t *testing.T) {
    tests := []struct {
        width    int
        height   int
        expected LayoutSize
    }{
        {80, 24, LayoutSmall},
        {100, 30, LayoutMedium},
        {120, 40, LayoutLarge},
    }
    
    for _, tt := range tests {
        result := CalculateLayout(tt.width, tt.height)
        if result.Size != tt.expected {
            t.Errorf("For %dx%d: expected %v, got %v",
                tt.width, tt.height, tt.expected, result.Size)
        }
    }
}

func TestLayoutSmallHidesActivity(t *testing.T) {
    layout := CalculateLayout(80, 24)
    if layout.ActivityVisible {
        t.Error("Small layout should hide activity")
    }
}

func TestLayoutLargeEnablesSideBySide(t *testing.T) {
    layout := CalculateLayout(120, 40)
    if !layout.SideBySide {
        t.Error("Large layout should enable side-by-side")
    }
}
```

### scripts/test-dashboard.sh

```bash
#!/bin/bash
# Manual visual testing script for dashboard

echo "=== CCPM TUI Dashboard Visual Test ==="
echo ""

# Check binary exists
if [ ! -f "./ccpm-tui" ]; then
    echo "Building ccpm-tui..."
    go build -o ccpm-tui ./cmd/ccpm-tui
fi

# Create test data
mkdir -p .claude/epics/visual-test
cat > .claude/epics/visual-test/epic.md << 'EOF'
---
name: visual-test
status: approved
created: 2025-12-23T10:00:00Z
---

# Visual Test Epic

Testing dashboard visualization.
EOF

cat > .claude/epics/visual-test/001.md << 'EOF'
---
id: "001"
name: Completed Task
status: completed
---
Test task that is complete.
EOF

cat > .claude/epics/visual-test/002.md << 'EOF'
---
id: "002"
name: In Progress Task
status: in-progress
---
Test task in progress.
EOF

echo "Test data created. Starting dashboard..."
echo "Press 'q' to quit when done testing."
echo ""

./ccpm-tui

# Cleanup
rm -rf .claude/epics/visual-test
echo "Test data cleaned up."
```

### Documentation Updates

Update `README.md` to add:
- TUI Dashboard section
- Installation instructions for Go binary
- Screenshot of dashboard
- Keyboard shortcuts summary

Update `COMMANDS.md` to add:
- `/pm:dashboard` command
- `/pm:epic-wizard` command
- `/pm:task-start-local` command
- `/pm:task-complete-local` command
- `/pm:sync-when-ready` command
- `/pm:steering-setup` command

## Definition of Done

- All parser tests pass
- Layout calculation tests pass
- Test coverage > 70% for parser package
- Manual test script works
- README.md updated with dashboard docs
- COMMANDS.md updated with new commands
- Keyboard shortcuts documented
