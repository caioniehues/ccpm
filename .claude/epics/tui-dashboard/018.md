---
id: "018"
name: Build and release pipeline
status: completed
created: 2025-12-23T19:45:00Z
updated: 2025-12-23T22:52:00Z
depends_on: ["017"]
parallel: false
conflicts_with: []
effort: M
---

# Task: Build and Release Pipeline

## Description

Set up the build and release pipeline for the TUI dashboard binary. Create cross-platform builds and integrate with the CCPM installation process.

## Acceptance Criteria

- [x] `go build` produces working binary
- [x] Cross-compilation for Linux, macOS (Intel + ARM), Windows
- [x] Binary size optimized (< 15MB) - ~5MB achieved
- [x] Version info embedded in binary
- [x] Makefile for common build tasks
- [x] GitHub Actions workflow for releases
- [ ] Installation integrated with CCPM installer (deferred)
- [x] `ccpm-tui --version` shows version info

## Files to Create

### Makefile

```makefile
# CCPM TUI Dashboard Makefile

VERSION ?= $(shell git describe --tags --always --dirty)
BUILD_TIME := $(shell date -u '+%Y-%m-%d_%H:%M:%S')
LDFLAGS := -ldflags "-s -w -X main.Version=$(VERSION) -X main.BuildTime=$(BUILD_TIME)"

.PHONY: all build clean test install cross-compile

all: build

build:
	go build $(LDFLAGS) -o ccpm-tui ./cmd/ccpm-tui

install:
	go install $(LDFLAGS) ./cmd/ccpm-tui

test:
	go test -v -cover ./internal/...

clean:
	rm -f ccpm-tui
	rm -rf dist/

# Cross-compilation for releases
cross-compile: clean
	mkdir -p dist
	
	# Linux AMD64
	GOOS=linux GOARCH=amd64 go build $(LDFLAGS) -o dist/ccpm-tui-linux-amd64 ./cmd/ccpm-tui
	
	# Linux ARM64
	GOOS=linux GOARCH=arm64 go build $(LDFLAGS) -o dist/ccpm-tui-linux-arm64 ./cmd/ccpm-tui
	
	# macOS Intel
	GOOS=darwin GOARCH=amd64 go build $(LDFLAGS) -o dist/ccpm-tui-darwin-amd64 ./cmd/ccpm-tui
	
	# macOS Apple Silicon
	GOOS=darwin GOARCH=arm64 go build $(LDFLAGS) -o dist/ccpm-tui-darwin-arm64 ./cmd/ccpm-tui
	
	# Windows
	GOOS=windows GOARCH=amd64 go build $(LDFLAGS) -o dist/ccpm-tui-windows-amd64.exe ./cmd/ccpm-tui
	
	# Compress binaries
	cd dist && gzip -k ccpm-tui-*
	
	# Create checksums
	cd dist && sha256sum ccpm-tui-* > checksums.txt

# Development build with race detector
dev:
	go build -race -o ccpm-tui ./cmd/ccpm-tui

# Lint
lint:
	golangci-lint run ./...

# Format
fmt:
	go fmt ./...
```

### cmd/ccpm-tui/version.go

```go
package main

import (
    "fmt"
    "runtime"
)

// Set via ldflags
var (
    Version   = "dev"
    BuildTime = "unknown"
)

func printVersion() {
    fmt.Printf("ccpm-tui %s\n", Version)
    fmt.Printf("  Built:    %s\n", BuildTime)
    fmt.Printf("  Go:       %s\n", runtime.Version())
    fmt.Printf("  OS/Arch:  %s/%s\n", runtime.GOOS, runtime.GOARCH)
}
```

### .github/workflows/release-tui.yml

```yaml
name: Release TUI Dashboard

on:
  push:
    tags:
      - 'tui-v*'

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'
      
      - name: Get version from tag
        id: version
        run: echo "VERSION=${GITHUB_REF#refs/tags/tui-}" >> $GITHUB_OUTPUT
      
      - name: Build binaries
        run: make cross-compile VERSION=${{ steps.version.outputs.VERSION }}
      
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            dist/ccpm-tui-*
            dist/checksums.txt
          body: |
            ## CCPM TUI Dashboard ${{ steps.version.outputs.VERSION }}
            
            ### Installation
            
            Download the appropriate binary for your platform and place it in your PATH.
            
            Or install via Go:
            ```bash
            go install github.com/automazeio/ccpm/cmd/ccpm-tui@${{ steps.version.outputs.VERSION }}
            ```
            
            ### Checksums
            Verify your download with the checksums.txt file.

  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'
      
      - name: Run tests
        run: make test
      
      - name: Run lint
        uses: golangci/golangci-lint-action@v3
        with:
          version: latest
```

### Update install/ccpm.sh

Add to installation script:
```bash
# Install TUI Dashboard (optional)
install_tui_dashboard() {
    echo "Installing TUI Dashboard..."
    
    # Detect platform
    OS=$(uname -s | tr '[:upper:]' '[:lower:]')
    ARCH=$(uname -m)
    
    case "$ARCH" in
        x86_64) ARCH="amd64" ;;
        aarch64|arm64) ARCH="arm64" ;;
    esac
    
    BINARY="ccpm-tui-${OS}-${ARCH}"
    URL="https://github.com/automazeio/ccpm/releases/latest/download/${BINARY}.gz"
    
    # Download and install
    curl -sL "$URL" | gunzip > ~/.local/bin/ccpm-tui
    chmod +x ~/.local/bin/ccpm-tui
    
    echo "TUI Dashboard installed: ~/.local/bin/ccpm-tui"
}

# Ask user if they want TUI
read -p "Install TUI Dashboard? (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    install_tui_dashboard
fi
```

## Release Process

1. Update version in code
2. Create and push tag: `git tag tui-v1.0.0 && git push --tags`
3. GitHub Actions builds and creates release
4. Users can download from releases page or use `go install`

## Definition of Done

- `make build` produces working binary
- `make cross-compile` creates all platform binaries
- `make test` passes all tests
- GitHub Actions workflow triggers on tags
- Release includes all platform binaries
- Installation script offers TUI as optional
- `ccpm-tui --version` shows correct version
