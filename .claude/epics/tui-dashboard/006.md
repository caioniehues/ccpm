---
id: "006"
name: Build core components (epic card, task list, activity)
status: completed
created: 2025-12-23T19:45:00Z
updated: 2025-12-23T20:15:00Z
depends_on: ["005"]
parallel: false
conflicts_with: []
effort: L
---

# Task: Build Core Components

## Description

Create reusable UI components that form the building blocks of all views: epic progress card, task list with custom delegate, activity log viewport, header, and footer.

## Acceptance Criteria

- [ ] EpicCard component shows epic name, description, progress bar, phase status
- [ ] TaskList component with custom delegate for status icons and selection
- [ ] Activity log viewport with scrolling and timestamps
- [ ] Header component with CCPM logo, branch name, commit hash
- [ ] Footer component with keybinding hints
- [ ] Progress bar with Neo-Brutalist gradient fill
- [ ] All components use styles from styles.go

## Files to Create

### internal/tui/components/epic_card.go

```go
package components

import (
    "fmt"
    "github.com/charmbracelet/lipgloss"
    "github.com/charmbracelet/bubbles/progress"
)

type EpicCard struct {
    Name        string
    Description string
    Progress    float64
    TasksDone   int
    TasksTotal  int
    PRDApproved bool
    EpicApproved bool
    TasksReady  bool
    Synced      bool
    Width       int
}

func (e EpicCard) View() string {
    // Title
    title := AccentStyle.Render("◆ ACTIVE EPIC")
    
    // Epic name
    name := TitleStyle.Render(e.Name)
    desc := BodyStyle.Render(e.Description)
    
    // Progress bar
    prog := progress.New(progress.WithGradient(Electric, Volt))
    progBar := prog.ViewAs(e.Progress)
    progText := fmt.Sprintf("%d/%d tasks", e.TasksDone, e.TasksTotal)
    
    // Phase indicators
    phases := e.renderPhases()
    
    // Compose card
    content := lipgloss.JoinVertical(
        lipgloss.Left,
        title,
        "",
        name,
        desc,
        "",
        progBar,
        progText,
        "",
        phases,
    )
    
    return ElevatedCard.Width(e.Width).Render(content)
}

func (e EpicCard) renderPhases() string {
    prd := "○"
    if e.PRDApproved { prd = "✓" }
    
    epic := "○"
    if e.EpicApproved { epic = "✓" }
    
    tasks := "○"
    if e.TasksReady { tasks = "◐" }
    if e.TasksDone == e.TasksTotal { tasks = "✓" }
    
    sync := "○"
    if e.Synced { sync = "✓" }
    
    return fmt.Sprintf("PRD %s    Epic %s    Tasks %s    Synced %s", prd, epic, tasks, sync)
}
```

### internal/tui/components/task_list.go

```go
package components

import (
    "fmt"
    "io"
    "github.com/charmbracelet/bubbles/list"
    "github.com/charmbracelet/lipgloss"
)

// TaskItem implements list.Item
type TaskItem struct {
    ID       string
    Name     string
    Status   string  // pending, in-progress, completed, blocked
    Progress float64
}

func (t TaskItem) Title() string       { return t.Name }
func (t TaskItem) Description() string { return t.ID }
func (t TaskItem) FilterValue() string { return t.Name }

// TaskDelegate renders task items
type TaskDelegate struct{}

func (d TaskDelegate) Height() int                         { return 1 }
func (d TaskDelegate) Spacing() int                        { return 0 }
func (d TaskDelegate) Update(msg tea.Msg, m *list.Model) tea.Cmd { return nil }

func (d TaskDelegate) Render(w io.Writer, m list.Model, index int, item list.Item) {
    task, ok := item.(TaskItem)
    if !ok {
        return
    }

    // Status icon
    icon := "▢"  // pending
    iconStyle := MutedStyle
    switch task.Status {
    case "completed":
        icon = "▣"
        iconStyle = SuccessStyle
    case "in-progress":
        icon = "▶"
        iconStyle = WarningStyle
    case "blocked":
        icon = "⊘"
        iconStyle = ErrorStyle
    }

    // Cursor
    cursor := "  "
    nameStyle := BodyStyle
    if index == m.Index() {
        cursor = "❯ "
        nameStyle = AccentStyle
    }

    // Status text
    statusText := ""
    switch task.Status {
    case "completed":
        statusText = "✓ Done"
    case "in-progress":
        statusText = fmt.Sprintf("◐ %d%%", int(task.Progress*100))
    case "blocked":
        statusText = "⚑ Blocked"
    }

    line := fmt.Sprintf("%s%s  %s: %s",
        cursor,
        iconStyle.Render(icon),
        MutedStyle.Render(task.ID),
        nameStyle.Render(task.Name),
    )
    
    if statusText != "" {
        padding := m.Width() - lipgloss.Width(line) - lipgloss.Width(statusText)
        if padding > 0 {
            line += strings.Repeat(" ", padding) + MutedStyle.Render(statusText)
        }
    }

    fmt.Fprint(w, line)
}

func NewTaskList(tasks []TaskItem, width, height int) list.Model {
    items := make([]list.Item, len(tasks))
    for i, t := range tasks {
        items[i] = t
    }

    l := list.New(items, TaskDelegate{}, width, height)
    l.SetShowTitle(false)
    l.SetShowStatusBar(false)
    l.SetFilteringEnabled(false)
    l.SetShowHelp(false)
    
    return l
}
```

### internal/tui/components/activity.go

```go
package components

import (
    "fmt"
    "github.com/charmbracelet/bubbles/viewport"
    "github.com/charmbracelet/lipgloss"
)

type ActivityEntry struct {
    Time    string
    Message string
    Type    string // success, info, warning, error
}

type ActivityLog struct {
    Entries  []ActivityEntry
    Viewport viewport.Model
    Width    int
    Height   int
}

func NewActivityLog(width, height int) ActivityLog {
    vp := viewport.New(width-4, height-2)
    return ActivityLog{
        Viewport: vp,
        Width:    width,
        Height:   height,
    }
}

func (a *ActivityLog) SetEntries(entries []ActivityEntry) {
    a.Entries = entries
    a.Viewport.SetContent(a.renderEntries())
    a.Viewport.GotoBottom()
}

func (a ActivityLog) renderEntries() string {
    var lines []string
    for _, entry := range a.Entries {
        icon := "ℹ"
        style := InfoStyle
        switch entry.Type {
        case "success":
            icon = "✓"
            style = SuccessStyle
        case "warning":
            icon = "⚠"
            style = WarningStyle
        case "error":
            icon = "✗"
            style = ErrorStyle
        }
        
        line := fmt.Sprintf("%s  %s %s",
            MutedStyle.Render(entry.Time),
            style.Render(icon),
            entry.Message,
        )
        lines = append(lines, line)
    }
    return strings.Join(lines, "\n")
}

func (a ActivityLog) View() string {
    title := LabelStyle.Render("ACTIVITY")
    scroll := MutedStyle.Render("↑↓")
    header := lipgloss.JoinHorizontal(lipgloss.Top, title, "  ", scroll)
    
    content := lipgloss.JoinVertical(lipgloss.Left, header, a.Viewport.View())
    return SubtleCard.Width(a.Width).Render(content)
}
```

### internal/tui/components/header.go & footer.go

Similar pattern for header with CCPM ASCII logo and footer with keybindings.

## Design Reference

- Progress Bars: TUI-WIREFRAMES.md lines 184-211
- List Items: TUI-WIREFRAMES.md lines 213-249
- Cards: TUI-WIREFRAMES.md lines 251-290

## Definition of Done

- All components render correctly with Neo-Brutalist styling
- TaskList selection works with keyboard navigation
- Activity log scrolls properly
- Components adapt to width constraints
